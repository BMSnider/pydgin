#=======================================================================
# isa.py
#=======================================================================

from pydgin.misc import create_risc_decoder, FatalError

#=======================================================================
# Instruction Encodings
#=======================================================================

encodings = [
  ['nop',      '000000_00000_00000_00000_00000_000000'],
  ['BEQ',       '?????????????????000?????1100011'],
  ['BNE',       '?????????????????001?????1100011'],
  ['BLT',       '?????????????????100?????1100011'],
  ['BGE',       '?????????????????101?????1100011'],
  ['BLTU',      '?????????????????110?????1100011'],
  ['BGEU',      '?????????????????111?????1100011'],
  ['JALR',      '?????????????????000?????1100111'],
  ['JAL',       '?????????????????????????1101111'],
  ['LUI',       '?????????????????????????0110111'],
  ['AUIPC',     '?????????????????????????0010111'],
  ['ADDI',      '?????????????????000?????0010011'],
  ['SLLI',      '000000???????????001?????0010011'],
  ['SLTI',      '?????????????????010?????0010011'],
  ['SLTIU',     '?????????????????011?????0010011'],
  ['XORI',      '?????????????????100?????0010011'],
  ['SRLI',      '000000???????????101?????0010011'],
  ['SRAI',      '010000???????????101?????0010011'],
  ['ORI',       '?????????????????110?????0010011'],
  ['ANDI',      '?????????????????111?????0010011'],
  ['ADD',       '0000000??????????000?????0110011'],
  ['SUB',       '0100000??????????000?????0110011'],
  ['SLL',       '0000000??????????001?????0110011'],
  ['SLT',       '0000000??????????010?????0110011'],
  ['SLTU',      '0000000??????????011?????0110011'],
  ['XOR',       '0000000??????????100?????0110011'],
  ['SRL',       '0000000??????????101?????0110011'],
  ['SRA',       '0100000??????????101?????0110011'],
  ['OR',        '0000000??????????110?????0110011'],
  ['AND',       '0000000??????????111?????0110011'],
  ['ADDIW',     '?????????????????000?????0011011'],
  ['SLLIW',     '0000000??????????001?????0011011'],
  ['SRLIW',     '0000000??????????101?????0011011'],
  ['SRAIW',     '0100000??????????101?????0011011'],
  ['ADDW',      '0000000??????????000?????0111011'],
  ['SUBW',      '0100000??????????000?????0111011'],
  ['SLLW',      '0000000??????????001?????0111011'],
  ['SRLW',      '0000000??????????101?????0111011'],
  ['SRAW',      '0100000??????????101?????0111011'],
  ['LB',        '?????????????????000?????0000011'],
  ['LH',        '?????????????????001?????0000011'],
  ['LW',        '?????????????????010?????0000011'],
  ['LD',        '?????????????????011?????0000011'],
  ['LBU',       '?????????????????100?????0000011'],
  ['LHU',       '?????????????????101?????0000011'],
  ['LWU',       '?????????????????110?????0000011'],
  ['SB',        '?????????????????000?????0100011'],
  ['SH',        '?????????????????001?????0100011'],
  ['SW',        '?????????????????010?????0100011'],
  ['SD',        '?????????????????011?????0100011'],
  ['FENCE',     '?????????????????000?????0001111'],
  ['FENCE_I',   '?????????????????001?????0001111'],
  ['MUL',       '0000001??????????000?????0110011'],
  ['MULH',      '0000001??????????001?????0110011'],
  ['MULHSU',    '0000001??????????010?????0110011'],
  ['MULHU',     '0000001??????????011?????0110011'],
  ['DIV',       '0000001??????????100?????0110011'],
  ['DIVU',      '0000001??????????101?????0110011'],
  ['REM', '0000001??????????110?????0110011'],
  ['REMU', '0000001??????????111?????0110011'],
  ['MULW', '0000001??????????000?????0111011'],
  ['DIVW', '0000001??????????100?????0111011'],
  ['DIVUW', '0000001??????????101?????0111011'],
  ['REMW', '0000001??????????110?????0111011'],
  ['REMUW', '0000001??????????111?????0111011'],
  ['AMOADD_W', '00000????????????010?????0101111'],
  ['AMOXOR_W', '00100????????????010?????0101111'],
  ['AMOOR_W', '01000????????????010?????0101111'],
  ['AMOAND_W', '01100????????????010?????0101111'],
  ['AMOMIN_W', '10000????????????010?????0101111'],
  ['AMOMAX_W', '10100????????????010?????0101111'],
  ['AMOMINU_W', '11000????????????010?????0101111'],
  ['AMOMAXU_W', '11100????????????010?????0101111'],
  ['AMOSWAP_W', '00001????????????010?????0101111'],
  ['LR_W', '00010??00000?????010?????0101111'],
  ['SC_W', '00011????????????010?????0101111'],
  ['AMOADD_D', '00000????????????011?????0101111'],
  ['AMOXOR_D', '00100????????????011?????0101111'],
  ['AMOOR_D', '01000????????????011?????0101111'],
  ['AMOAND_D', '01100????????????011?????0101111'],
  ['AMOMIN_D', '10000????????????011?????0101111'],
  ['AMOMAX_D', '10100????????????011?????0101111'],
  ['AMOMINU_D', '11000????????????011?????0101111'],
  ['AMOMAXU_D', '11100????????????011?????0101111'],
  ['AMOSWAP_D', '00001????????????011?????0101111'],
  ['LR_D', '00010??00000?????011?????0101111'],
  ['SC_D', '00011????????????011?????0101111'],
  ['SCALL', '00000000000000000000000001110011'],
  ['SBREAK', '00000000000100000000000001110011'],
  ['SRET', '00010000000000000000000001110011'],
  ['SFENCE_VM', '000100000001?????000000001110011'],
  ['WFI', '00010000001000000000000001110011'],
  ['MRTH', '00110000011000000000000001110011'],
  ['MRTS', '00110000010100000000000001110011'],
  ['HRTS', '00100000010100000000000001110011'],
  ['CSRRW',    '?????????????????001?????1110011'],
  ['CSRRS',    '?????????????????010?????1110011'],
  ['CSRRC',    '?????????????????011?????1110011'],
  ['CSRRWI',   '?????????????????101?????1110011'],
  ['CSRRSI',   '?????????????????110?????1110011'],
  ['CSRRCI',   '?????????????????111?????1110011'],
  ['FADD_S',   '0000000??????????????????1010011'],
  ['FSUB_S',   '0000100??????????????????1010011'],
  ['FMUL_S',   '0001000??????????????????1010011'],
  ['FDIV_S',   '0001100??????????????????1010011'],
  ['FSGNJ_S',  '0010000??????????000?????1010011'],
  ['FSGNJN_S', '0010000??????????001?????1010011'],
  ['FSGNJX_S', '0010000??????????010?????1010011'],
  ['FMIN_S',   '0010100??????????000?????1010011'],
  ['FMAX_S',   '0010100??????????001?????1010011'],
  ['FSQRT_S',  '010110000000?????????????1010011'],
  ['FADD_D',   '0000001??????????????????1010011'],
  ['FSUB_D',   '0000101??????????????????1010011'],
  ['FMUL_D',   '0001001??????????????????1010011'],
  ['FDIV_D',   '0001101??????????????????1010011'],
  ['FSGNJ_D',  '0010001??????????000?????1010011'],
  ['FSGNJN_D', '0010001??????????001?????1010011'],
  ['FSGNJX_D', '0010001??????????010?????1010011'],
  ['FMIN_D',   '0010101??????????000?????1010011'],
  ['FMAX_D',   '0010101??????????001?????1010011'],
  ['FCVT_S_D', '010000000001?????????????1010011'],
  ['FCVT_D_S', '010000100000?????????????1010011'],
  ['FSQRT_D',  '010110100000?????????????1010011'],
  ['FLE_S',      '1010000??????????000?????1010011'],
  ['FLT_S',      '1010000??????????001?????1010011'],
  ['FEQ_S',      '1010000??????????010?????1010011'],
  ['FLE_D',      '1010001??????????000?????1010011'],
  ['FLT_D',      '1010001??????????001?????1010011'],
  ['FEQ_D',      '1010001??????????010?????1010011'],
  ['FCVT_W_S',   '110000000000?????????????1010011'],
  ['FCVT_WU_S',  '110000000001?????????????1010011'],
  ['FCVT_L_S',   '110000000010?????????????1010011'],
  ['FCVT_LU_S',  '110000000011?????????????1010011'],
  ['FMV_X_S',    '111000000000?????000?????1010011'],
  ['FCLASS_S',   '111000000000?????001?????1010011'],
  ['FCVT_W_D',   '110000100000?????????????1010011'],
  ['FCVT_WU_D',  '110000100001?????????????1010011'],
  ['FCVT_L_D',   '110000100010?????????????1010011'],
  ['FCVT_LU_D',  '110000100011?????????????1010011'],
  ['FMV_X_D',    '111000100000?????000?????1010011'],
  ['FCLASS_D',   '111000100000?????001?????1010011'],
  ['FCVT_S_W',   '110100000000?????????????1010011'],
  ['FCVT_S_WU',  '110100000001?????????????1010011'],
  ['FCVT_S_L',   '110100000010?????????????1010011'],
  ['FCVT_S_LU',  '110100000011?????????????1010011'],
  ['FMV_S_X',    '111100000000?????000?????1010011'],
  ['FCVT_D_W',   '110100100000?????????????1010011'],
  ['FCVT_D_WU',  '110100100001?????????????1010011'],
  ['FCVT_D_L',   '110100100010?????????????1010011'],
  ['FCVT_D_LU',  '110100100011?????????????1010011'],
  ['FMV_D_X',            '111100100000?????000?????1010011'],
  ['FLW',                '?????????????????010?????0000111'],
  ['FLD',                '?????????????????011?????0000111'],
  ['FSW',                '?????????????????010?????0100111'],
  ['FSD',                '?????????????????011?????0100111'],
  ['FMADD_S',            '?????00??????????????????1000011'],
  ['FMSUB_S',            '?????00??????????????????1000111'],
  ['FNMSUB_S',           '?????00??????????????????1001011'],
  ['FNMADD_S',           '?????00??????????????????1001111'],
  ['FMADD_D',            '?????01??????????????????1000011'],
  ['FMSUB_D',            '?????01??????????????????1000111'],
  ['FNMSUB_D',           '?????01??????????????????1001011'],
  ['FNMADD_D',           '?????01??????????????????1001111'],
  ['CUSTOM0',            '?????????????????000?????0001011'],
  ['CUSTOM0_RS1',      '?????????????????010?????0001011'],
  ['CUSTOM0_RS1_RS2', '?????????????????011?????0001011'],
  ['CUSTOM0_RD',         '?????????????????100?????0001011'],
  ['CUSTOM0_RD_RS1',     '?????????????????110?????0001011'],
  ['CUSTOM0_RD_RS1_RS2', '?????????????????111?????0001011'],
  ['CUSTOM1',            '?????????????????000?????0101011'],
  ['CUSTOM1_RS1',        '?????????????????010?????0101011'],
  ['CUSTOM1_RS1_RS2',    '?????????????????011?????0101011'],
  ['CUSTOM1_RD',         '?????????????????100?????0101011'],
  ['CUSTOM1_RD_RS1',     '?????????????????110?????0101011'],
  ['CUSTOM1_RD_RS1_RS2', '?????????????????111?????0101011'],
  ['CUSTOM2',            '?????????????????000?????1011011'],
  ['CUSTOM2_RS1',        '?????????????????010?????1011011'],
  ['CUSTOM2_RS1_RS2',    '?????????????????011?????1011011'],
  ['CUSTOM2_RD',         '?????????????????100?????1011011'],
  ['CUSTOM2_RD_RS1',     '?????????????????110?????1011011'],
  ['CUSTOM2_RD_RS1_RS2', '?????????????????111?????1011011'],
  ['CUSTOM3',            '?????????????????000?????1111011'],
  ['CUSTOM3_RS1',        '?????????????????010?????1111011'],
  ['CUSTOM3_RS1_RS2',    '?????????????????011?????1111011'],
  ['CUSTOM3_RD',         '?????????????????100?????1111011'],
  ['CUSTOM3_RD_RS1',     '?????????????????110?????1111011'],
  ['CUSTOM3_RD_RS1_RS2', '?????????????????111?????1111011'],

]

#=======================================================================
# Instruction Definitions
#=======================================================================

#-----------------------------------------------------------------------
# nop
#-----------------------------------------------------------------------
def execute_nop( s, inst ):
  s.pc += 4

#=======================================================================
# Create Decoder
#=======================================================================

decode = create_risc_decoder( encodings, globals(), debug=True )

